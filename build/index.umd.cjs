(function(u,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(u=typeof globalThis<"u"?globalThis:u||self,u.TileLnglatTransform=a())})(this,function(){"use strict";var v=Object.defineProperty;var A=(u,a,M)=>a in u?v(u,a,{enumerable:!0,configurable:!0,writable:!0,value:M}):u[a]=M;var x=(u,a,M)=>(A(u,typeof a!="symbol"?a+"":a,M),M);function u(e){return(Math.exp(e)-Math.exp(-e))/2}class a{constructor(t,i){x(this,"levelMax");x(this,"levelMin");this.levelMax=t,this.levelMin=i}_getMapSize(t){return Math.pow(2,t)}getResolution(t,i){return 12756274*Math.PI*Math.cos(t)/256/this._getMapSize(i)}_lngToTileX(t,i){let n=(t+180)/360,l=Math.floor(n*this._getMapSize(i));return l=Math.min(l,Math.pow(2,i)-1),l}_latToTileY(t,i){let n=t*Math.PI/180,l=(1-Math.log(Math.tan(n)+1/Math.cos(n))/Math.PI)/2;return Math.floor(l*this._getMapSize(i))}lnglatToTile(t,i,n){let l=this._lngToTileX(t,n),o=this._latToTileY(i,n);return{tileX:l,tileY:o}}_lngToPixelX(t,i){let n=(t+180)/360;return Math.floor(n*this._getMapSize(i)*256%256)}_latToPixelY(t,i){let n=Math.sin(t*Math.PI/180),l=.5-Math.log((1+n)/(1-n))/(4*Math.PI);return Math.floor(l*this._getMapSize(i)*256%256)}lnglatToPixel(t,i,n){let l=this._lngToPixelX(t,n),o=this._latToPixelY(i,n);return{pixelX:l,pixelY:o}}_pixelXTolng(t,i,n){let l=t/256;return(i+l)/this._getMapSize(n)*360-180}_pixelYToLat(t,i,n){let l=t/256;return Math.atan(u(Math.PI*(1-2*(i+l)/this._getMapSize(n))))*180/Math.PI}pixelToLnglat(t,i,n,l,o){let s=this._pixelXTolng(t,n,o),f=this._pixelYToLat(i,l,o);return{lng:s,lat:f}}}function M(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function w(e,t){for(var i in t)e[i]=t[i]}function Y(e){return typeof e=="string"}var y=void 0,c=null;function h(e,t){isNaN(e)&&(e=Ib(e),e=isNaN(e)?0:e),Y(e)&&(e=parseFloat(e)),isNaN(t)&&(t=Ib(t),t=isNaN(t)?0:t),Y(t)&&(t=parseFloat(t)),this.lng=e,this.lat=t}h.TL=function(e){return e&&180>=e.lng&&-180<=e.lng&&74>=e.lat&&-74<=e.lat},h.prototype.lb=function(e){return e&&this.lat==e.lat&&this.lng==e.lng};function _(e,t){this.x=e||0,this.y=t||0,this.x=this.x,this.y=this.y}_.prototype.lb=function(e){return e&&e.x==this.x&&e.y==this.y};function m(){}m.prototype.nh=function(){aa("lngLatToPoint方法未实现")},m.prototype.wi=function(){aa("pointToLngLat方法未实现")};function p(){}p.prototype=new m,M(p,{$O:637099681e-2,lG:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],Au:[75,60,45,30,15,0],fP:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function(l,t){if(!l||!t)return 0;var i,n,l=this.Fb(l);return l?(i=this.Tk(l.lng),n=this.Tk(l.lat),t=this.Fb(t),t?this.Pe(i,this.Tk(t.lng),n,this.Tk(t.lat)):0):0},Vo:function(e,t){return!e||!t?0:(e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),this.Pe(this.Tk(e.lng),this.Tk(t.lng),this.Tk(e.lat),this.Tk(t.lat)))},Fb:function(e){if(e===c||e===y)return new h(0,0);var t,i;t=new h(Math.abs(e.lng),Math.abs(e.lat));for(var n=0;n<this.lG.length;n++)if(t.lat>=this.lG[n]){i=this.fP[n];break}return e=this.gK(e,i),e=new h(e.lng.toFixed(6),e.lat.toFixed(6))},Eb:function(e){if(e===c||e===y||180<e.lng||-180>e.lng||90<e.lat||-90>e.lat)return new h(0,0);var t,i;e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),t=new h(e.lng,e.lat);for(var n=0;n<this.Au.length;n++)if(t.lat>=this.Au[n]){i=this.iG[n];break}if(!i){for(n=0;n<this.Au.length;n++)if(t.lat<=-this.Au[n]){i=this.iG[n];break}}return e=this.gK(e,i),e=new h(e.lng.toFixed(2),e.lat.toFixed(2))},gK:function(e,t){if(e&&t){var i=t[0]+t[1]*Math.abs(e.lng),n=Math.abs(e.lat)/t[9],n=t[2]+t[3]*n+t[4]*n*n+t[5]*n*n*n+t[6]*n*n*n*n+t[7]*n*n*n*n*n+t[8]*n*n*n*n*n*n,i=i*(0>e.lng?-1:1),n=n*(0>e.lat?-1:1);return new h(i,n)}},Pe:function(e,t,i,n){return this.$O*Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(t-e))},Tk:function(e){return Math.PI*e/180},Z3:function(e){return 180*e/Math.PI},ND:function(e,t,i){return t!=c&&(e=Math.max(e,t)),i!=c&&(e=Math.min(e,i)),e},JD:function(e,t,i){for(;e>i;)e-=i-t;for(;e<t;)e+=i-t;return e}}),M(p.prototype,{Jm:function(e){return p.Eb(e)},nh:function(e){return e=p.Eb(e),new _(e.lng,e.lat)},qh:function(e){return p.Fb(e)},wi:function(e){return e=new h(e.x,e.y),p.Fb(e)},fc:function(e,t,i,n,l){if(e)return e=this.Jm(e,l),t=this.Lc(t),new _(Math.round((e.lng-i.lng)/t+n.width/2),Math.round((i.lat-e.lat)/t+n.height/2))},zb:function(e,t,i,n,l){if(e)return t=this.Lc(t),this.qh(new h(i.lng+t*(e.x-n.width/2),i.lat-t*(e.y-n.height/2)),l)},Lc:function(e){return Math.pow(2,18-e)}});var P=p.prototype;w(P,{lngLatToPoint:P.nh,pointToLngLat:P.wi});let X={Point:h,Pixel:_,MercatorProjection:p};class d{constructor(t,i){x(this,"levelMax");x(this,"levelMin");x(this,"projection");this.levelMax=t,this.levelMin=i,this.projection=new X.MercatorProjection}_getRetain(t){return Math.pow(2,t-18)}getResolution(t,i){return Math.pow(2,18-i)*Math.cos(t)}lnglatToPoint(t,i){let n=new X.Point(t,i),l=this.projection.lngLatToPoint(n);return{pointX:l.x,pointY:l.y}}pointToLnglat(t,i){let n=new X.Pixel(t,i),l=this.projection.pointToLngLat(n);return{lng:l.lng,lat:l.lat}}_lngToTileX(t,i){let n=this.lnglatToPoint(t,0);return Math.floor(n.pointX*this._getRetain(i)/256)}_latToTileY(t,i){let n=this.lnglatToPoint(0,t);return Math.floor(n.pointY*this._getRetain(i)/256)}lnglatToTile(t,i,n){let l=this._lngToTileX(t,n),o=this._latToTileY(i,n);return{tileX:l,tileY:o}}_lngToPixelX(t,i){let n=this._lngToTileX(t,i),l=this.lnglatToPoint(t,0);return Math.floor(l.pointX*this._getRetain(i)-n*256)}_latToPixelY(t,i){let n=this._latToTileY(t,i),l=this.lnglatToPoint(0,t);return Math.floor(l.pointY*this._getRetain(i)-n*256)}lnglatToPixel(t,i,n){let l=this._lngToPixelX(t,n),o=this._latToPixelY(i,n);return{pixelX:l,pixelY:o}}_pixelXToLng(t,i,n){let l=(i*256+t)/this._getRetain(n);return this.pointToLnglat(l,0).lng}_pixelYToLat(t,i,n){let l=(i*256+t)/this._getRetain(n);return this.pointToLnglat(0,l).lat}pixelToLnglat(t,i,n,l,o){let s=(n*256+t)/this._getRetain(o),f=(l*256+i)/this._getRetain(o);return this.pointToLnglat(s,f)}}function S(e){return(Math.exp(e)-Math.exp(-e))/2}class I{constructor(t,i){x(this,"levelMax");x(this,"levelMin");this.levelMax=t,this.levelMin=i}_getMapSize(t){return Math.pow(2,t)}getResolution(t,i){return 12756274*Math.PI*Math.cos(t)/256/this._getMapSize(i)}_lngToTileX(t,i){let n=(t+180)/360,l=Math.floor(n*this._getMapSize(i));return l=Math.min(l,Math.pow(2,i)-1),l}_latToTileY(t,i){let n=t*Math.PI/180,l=(1+Math.log(Math.tan(n)+1/Math.cos(n))/Math.PI)/2;return Math.floor(l*this._getMapSize(i))}lnglatToTile(t,i,n){let l=this._lngToTileX(t,n),o=this._latToTileY(i,n);return{tileX:l,tileY:o}}_lngToPixelX(t,i){let n=(t+180)/360;return Math.floor(n*this._getMapSize(i)*256%256)}_latToPixelY(t,i){let n=Math.sin(t*Math.PI/180),l=.5+Math.log((1+n)/(1-n))/(4*Math.PI);return 255-Math.floor(l*this._getMapSize(i)*256%256)}lnglatToPixel(t,i,n){let l=this._lngToPixelX(t,n),o=this._latToPixelY(i,n);return{pixelX:l,pixelY:o}}_pixelXTolng(t,i,n){let l=t/256;return(i+l)/this._getMapSize(n)*360-180}_pixelYToLat(t,i,n){let l=t/256;return Math.atan(S(Math.PI*(-1+2*(i+1-l)/this._getMapSize(n))))*180/Math.PI}pixelToLnglat(t,i,n,l,o){let s=this._pixelXTolng(t,n,o),f=this._pixelYToLat(i,l,o);return{lng:s,lat:f}}}class k extends a{constructor(t,i){super(t,i)}lnglatToQuadkey(t,i,n){let l=t.toString(2),o=i.toString(2);l="0".repeat(n-l.length)+l,o="0".repeat(n-o.length)+o;let s="";for(let T=0;T<n;T++)s=s+o[T]+l[T];return s=s.replace(/^0*/,""),Number.parseInt(s,2).toString(4)}quadkeyToLnglat(t){const i=t.length;let l=Number.parseInt(t,4).toString(2);l.length%2!=0&&(l="0"+l);let o="",s="";for(let T=0;T<l.length;T++)T%2===0?o=o+l[T]:s=s+l[T];const f=Number.parseInt(o,2);return{tileX:Number.parseInt(s,2),tileY:f,level:i}}}const r={Gaode:"Gaode",Google:"Google",Baidu:"Baidu",OSM:"OSM",Tencent:"Tencent",Bing:"Bing"},g={[r.Gaode]:{min:1,max:19},[r.Google]:{min:0,max:21},[r.OSM]:{min:0,max:19},[r.Baidu]:{min:3,max:18},[r.Tencent]:{min:3,max:19},[r.Bing]:{min:3,max:19}},G=new a(g[r.Gaode].max,g[r.Gaode].min),z=new a(g[r.Google].max,g[r.Google].min),N=new a(g[r.OSM].max,g[r.OSM].min),B=new d(g[r.Baidu].max,g[r.Baidu].min),R=new I(g[r.Tencent].max,g[r.Tencent].min),F=new k(g[r.Bing].max,g[r.Bing].min);return{TileLnglatTransformGaode:G,TileLnglatTransformGoogle:z,TileLnglatTransformOSM:N,TileLnglatTransformBaidu:B,TileLnglatTransformTencent:R,TileLnglatTransformBing:F}});
